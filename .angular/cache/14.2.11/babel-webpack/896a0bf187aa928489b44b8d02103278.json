{"ast":null,"code":"import { factory } from '../../../utils/factory.js';\nimport { createSolveValidation } from './utils/solveValidation.js';\nvar name = 'usolve';\nvar dependencies = ['typed', 'matrix', 'divideScalar', 'multiplyScalar', 'subtract', 'equalScalar', 'DenseMatrix'];\nexport var createUsolve = /* #__PURE__ */factory(name, dependencies, _ref => {\n  var {\n    typed,\n    matrix,\n    divideScalar,\n    multiplyScalar,\n    subtract,\n    equalScalar,\n    DenseMatrix\n  } = _ref;\n  var solveValidation = createSolveValidation({\n    DenseMatrix\n  });\n  /**\n   * Finds one solution of a linear equation system by backward substitution. Matrix must be an upper triangular matrix. Throws an error if there's no solution.\n   *\n   * `U * x = b`\n   *\n   * Syntax:\n   *\n   *    math.usolve(U, b)\n   *\n   * Examples:\n   *\n   *    const a = [[-2, 3], [2, 1]]\n   *    const b = [11, 9]\n   *    const x = usolve(a, b)  // [[8], [9]]\n   *\n   * See also:\n   *\n   *    usolveAll, lup, slu, usolve, lusolve\n   *\n   * @param {Matrix, Array} U       A N x N matrix or array (U)\n   * @param {Matrix, Array} b       A column vector with the b values\n   *\n   * @return {DenseMatrix | Array}  A column vector with the linear system solution (x)\n   */\n\n  return typed(name, {\n    'SparseMatrix, Array | Matrix': function SparseMatrixArrayMatrix(m, b) {\n      return _sparseBackwardSubstitution(m, b);\n    },\n    'DenseMatrix, Array | Matrix': function DenseMatrixArrayMatrix(m, b) {\n      return _denseBackwardSubstitution(m, b);\n    },\n    'Array, Array | Matrix': function ArrayArrayMatrix(a, b) {\n      var m = matrix(a);\n\n      var r = _denseBackwardSubstitution(m, b);\n\n      return r.valueOf();\n    }\n  });\n\n  function _denseBackwardSubstitution(m, b) {\n    // make b into a column vector\n    b = solveValidation(m, b, true);\n    var bdata = b._data;\n    var rows = m._size[0];\n    var columns = m._size[1]; // result\n\n    var x = [];\n    var mdata = m._data; // loop columns backwards\n\n    for (var j = columns - 1; j >= 0; j--) {\n      // b[j]\n      var bj = bdata[j][0] || 0; // x[j]\n\n      var xj = void 0;\n\n      if (!equalScalar(bj, 0)) {\n        // value at [j, j]\n        var vjj = mdata[j][j];\n\n        if (equalScalar(vjj, 0)) {\n          // system cannot be solved\n          throw new Error('Linear system cannot be solved since matrix is singular');\n        }\n\n        xj = divideScalar(bj, vjj); // loop rows\n\n        for (var i = j - 1; i >= 0; i--) {\n          // update copy of b\n          bdata[i] = [subtract(bdata[i][0] || 0, multiplyScalar(xj, mdata[i][j]))];\n        }\n      } else {\n        // zero value at j\n        xj = 0;\n      } // update x\n\n\n      x[j] = [xj];\n    }\n\n    return new DenseMatrix({\n      data: x,\n      size: [rows, 1]\n    });\n  }\n\n  function _sparseBackwardSubstitution(m, b) {\n    // make b into a column vector\n    b = solveValidation(m, b, true);\n    var bdata = b._data;\n    var rows = m._size[0];\n    var columns = m._size[1];\n    var values = m._values;\n    var index = m._index;\n    var ptr = m._ptr; // result\n\n    var x = []; // loop columns backwards\n\n    for (var j = columns - 1; j >= 0; j--) {\n      var bj = bdata[j][0] || 0;\n\n      if (!equalScalar(bj, 0)) {\n        // non-degenerate row, find solution\n        var vjj = 0; // upper triangular matrix values & index (column j)\n\n        var jValues = [];\n        var jIndices = []; // first & last indeces in column\n\n        var firstIndex = ptr[j];\n        var lastIndex = ptr[j + 1]; // values in column, find value at [j, j], loop backwards\n\n        for (var k = lastIndex - 1; k >= firstIndex; k--) {\n          var i = index[k]; // check row (rows are not sorted!)\n\n          if (i === j) {\n            vjj = values[k];\n          } else if (i < j) {\n            // store upper triangular\n            jValues.push(values[k]);\n            jIndices.push(i);\n          }\n        } // at this point we must have a value in vjj\n\n\n        if (equalScalar(vjj, 0)) {\n          throw new Error('Linear system cannot be solved since matrix is singular');\n        }\n\n        var xj = divideScalar(bj, vjj);\n\n        for (var _k = 0, _lastIndex = jIndices.length; _k < _lastIndex; _k++) {\n          var _i = jIndices[_k];\n          bdata[_i] = [subtract(bdata[_i][0], multiplyScalar(xj, jValues[_k]))];\n        }\n\n        x[j] = [xj];\n      } else {\n        // degenerate row, we can choose any value\n        x[j] = [0];\n      }\n    }\n\n    return new DenseMatrix({\n      data: x,\n      size: [rows, 1]\n    });\n  }\n});","map":{"version":3,"names":["factory","createSolveValidation","name","dependencies","createUsolve","_ref","typed","matrix","divideScalar","multiplyScalar","subtract","equalScalar","DenseMatrix","solveValidation","SparseMatrixArrayMatrix","m","b","_sparseBackwardSubstitution","DenseMatrixArrayMatrix","_denseBackwardSubstitution","ArrayArrayMatrix","a","r","valueOf","bdata","_data","rows","_size","columns","x","mdata","j","bj","xj","vjj","Error","i","data","size","values","_values","index","_index","ptr","_ptr","jValues","jIndices","firstIndex","lastIndex","k","push","_k","_lastIndex","length","_i"],"sources":["C:/Users/lenovo/node_modules/mathjs/lib/esm/function/algebra/solver/usolve.js"],"sourcesContent":["import { factory } from '../../../utils/factory.js';\nimport { createSolveValidation } from './utils/solveValidation.js';\nvar name = 'usolve';\nvar dependencies = ['typed', 'matrix', 'divideScalar', 'multiplyScalar', 'subtract', 'equalScalar', 'DenseMatrix'];\nexport var createUsolve = /* #__PURE__ */factory(name, dependencies, _ref => {\n  var {\n    typed,\n    matrix,\n    divideScalar,\n    multiplyScalar,\n    subtract,\n    equalScalar,\n    DenseMatrix\n  } = _ref;\n  var solveValidation = createSolveValidation({\n    DenseMatrix\n  });\n\n  /**\n   * Finds one solution of a linear equation system by backward substitution. Matrix must be an upper triangular matrix. Throws an error if there's no solution.\n   *\n   * `U * x = b`\n   *\n   * Syntax:\n   *\n   *    math.usolve(U, b)\n   *\n   * Examples:\n   *\n   *    const a = [[-2, 3], [2, 1]]\n   *    const b = [11, 9]\n   *    const x = usolve(a, b)  // [[8], [9]]\n   *\n   * See also:\n   *\n   *    usolveAll, lup, slu, usolve, lusolve\n   *\n   * @param {Matrix, Array} U       A N x N matrix or array (U)\n   * @param {Matrix, Array} b       A column vector with the b values\n   *\n   * @return {DenseMatrix | Array}  A column vector with the linear system solution (x)\n   */\n  return typed(name, {\n    'SparseMatrix, Array | Matrix': function SparseMatrixArrayMatrix(m, b) {\n      return _sparseBackwardSubstitution(m, b);\n    },\n    'DenseMatrix, Array | Matrix': function DenseMatrixArrayMatrix(m, b) {\n      return _denseBackwardSubstitution(m, b);\n    },\n    'Array, Array | Matrix': function ArrayArrayMatrix(a, b) {\n      var m = matrix(a);\n      var r = _denseBackwardSubstitution(m, b);\n      return r.valueOf();\n    }\n  });\n  function _denseBackwardSubstitution(m, b) {\n    // make b into a column vector\n    b = solveValidation(m, b, true);\n    var bdata = b._data;\n    var rows = m._size[0];\n    var columns = m._size[1];\n\n    // result\n    var x = [];\n    var mdata = m._data;\n    // loop columns backwards\n    for (var j = columns - 1; j >= 0; j--) {\n      // b[j]\n      var bj = bdata[j][0] || 0;\n      // x[j]\n      var xj = void 0;\n      if (!equalScalar(bj, 0)) {\n        // value at [j, j]\n        var vjj = mdata[j][j];\n        if (equalScalar(vjj, 0)) {\n          // system cannot be solved\n          throw new Error('Linear system cannot be solved since matrix is singular');\n        }\n        xj = divideScalar(bj, vjj);\n\n        // loop rows\n        for (var i = j - 1; i >= 0; i--) {\n          // update copy of b\n          bdata[i] = [subtract(bdata[i][0] || 0, multiplyScalar(xj, mdata[i][j]))];\n        }\n      } else {\n        // zero value at j\n        xj = 0;\n      }\n      // update x\n      x[j] = [xj];\n    }\n    return new DenseMatrix({\n      data: x,\n      size: [rows, 1]\n    });\n  }\n  function _sparseBackwardSubstitution(m, b) {\n    // make b into a column vector\n    b = solveValidation(m, b, true);\n    var bdata = b._data;\n    var rows = m._size[0];\n    var columns = m._size[1];\n    var values = m._values;\n    var index = m._index;\n    var ptr = m._ptr;\n\n    // result\n    var x = [];\n\n    // loop columns backwards\n    for (var j = columns - 1; j >= 0; j--) {\n      var bj = bdata[j][0] || 0;\n      if (!equalScalar(bj, 0)) {\n        // non-degenerate row, find solution\n\n        var vjj = 0;\n\n        // upper triangular matrix values & index (column j)\n        var jValues = [];\n        var jIndices = [];\n\n        // first & last indeces in column\n        var firstIndex = ptr[j];\n        var lastIndex = ptr[j + 1];\n\n        // values in column, find value at [j, j], loop backwards\n        for (var k = lastIndex - 1; k >= firstIndex; k--) {\n          var i = index[k];\n\n          // check row (rows are not sorted!)\n          if (i === j) {\n            vjj = values[k];\n          } else if (i < j) {\n            // store upper triangular\n            jValues.push(values[k]);\n            jIndices.push(i);\n          }\n        }\n\n        // at this point we must have a value in vjj\n        if (equalScalar(vjj, 0)) {\n          throw new Error('Linear system cannot be solved since matrix is singular');\n        }\n        var xj = divideScalar(bj, vjj);\n        for (var _k = 0, _lastIndex = jIndices.length; _k < _lastIndex; _k++) {\n          var _i = jIndices[_k];\n          bdata[_i] = [subtract(bdata[_i][0], multiplyScalar(xj, jValues[_k]))];\n        }\n        x[j] = [xj];\n      } else {\n        // degenerate row, we can choose any value\n        x[j] = [0];\n      }\n    }\n    return new DenseMatrix({\n      data: x,\n      size: [rows, 1]\n    });\n  }\n});"],"mappings":"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"},"metadata":{},"sourceType":"module"}